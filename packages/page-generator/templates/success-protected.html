<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="site-slug" content="{{SITE_SLUG}}">
<title>Download {{PACK_NAME}} | {{SITE_NAME}}</title>

<!-- Google Analytics 4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{GA4_ID}}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{GA4_ID}}', {
    'send_page_view': true,
    'cookie_flags': 'SameSite=None;Secure'
  });
</script>

<!-- SEO Meta Tags -->
<meta name="description" content="Download your free {{PACK_NAME}} PDF.">
<meta name="robots" content="noindex, nofollow">
<link rel="canonical" href="{{SITE_URL}}/success-{{PACK_SLUG}}.html">

<!-- Theme & Favicon -->
<meta name="theme-color" content="#f59e0b">
<link rel="icon" type="image/png" href="/images/favicon.png">
<link rel="apple-touch-icon" href="/images/favicon.png">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- Scripts -->
<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- Tailwind Config -->
<script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    'anton': ['Anton', 'sans-serif'],
                    'sans': ['Inter', 'sans-serif'],
                },
                colors: {
                    brand: {
                        50: '#fffbeb',
                        100: '#fef3c7',
                        500: '#f59e0b',
                        600: '#d97706',
                        900: '#451a03',
                    },
                    accent: {
                        500: '#10b981',
                    }
                }
            }
        }
    }
</script>

<style>
    [x-cloak] { display: none !important; }
    .glass-nav {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }
    .anton-text {
        font-family: 'Anton', sans-serif;
        letter-spacing: 0.05em;
    }
</style>

</head>
<body class="min-h-screen flex flex-col bg-slate-50 text-slate-900 font-sans">

<!-- Top Navigation -->
<header class="sticky top-0 z-50 glass-nav border-b border-slate-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <div class="flex items-center">
                <a href="/" class="flex items-center">
                    <img src="/images/logo.png" alt="{{SITE_NAME}}" class="h-12 md:h-16 w-auto">
                </a>
            </div>
            <nav class="hidden md:flex space-x-8 items-center">
                <a href="/#recipes" class="text-slate-600 hover:text-brand-600 font-semibold text-sm uppercase tracking-wider">Recipes</a>
                <a href="/#categories" class="text-slate-600 hover:text-brand-600 font-semibold text-sm uppercase tracking-wider">Categories</a>
                <a href="/#packs" class="text-slate-600 hover:text-brand-600 font-semibold text-sm uppercase tracking-wider">Recipe Packs</a>
            </nav>
        </div>
    </div>
</header>

<main class="flex-grow py-20">
    <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        
        <!-- Loading State -->
        <div id="loading-state" style="display: block;">
            <div class="animate-pulse">
                <span class="text-6xl mb-6 block">‚è≥</span>
                <h1 class="anton-text text-4xl uppercase mb-4 tracking-wider">VERIFYING ACCESS...</h1>
                <p class="text-xl text-slate-600">Please wait while we verify your subscription.</p>
            </div>
        </div>

        <!-- Success State (shown after verification) -->
        <div id="success-state" style="display: none;">
            <span class="text-6xl mb-6 block">‚úÖ</span>
            <h1 class="anton-text text-4xl uppercase mb-4 tracking-wider">YOU'RE ALL SET!</h1>
            <p class="text-xl text-slate-600 mb-2">Your {{PACK_NAME}} is ready to download.</p>
            <p class="text-sm text-slate-500 mb-8">Confirmed for: <span id="user-email" class="font-semibold text-slate-700"></span></p>
            
            <a id="download-btn" href="/guides/{{SITE_SLUG}}-{{PACK_SLUG}}.pdf" download
                class="inline-flex items-center gap-3 bg-brand-500 text-white px-8 py-4 rounded-2xl font-bold anton-text text-lg hover:bg-brand-600 transition-colors shadow-xl shadow-brand-500/30 tracking-wider mb-8">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
                DOWNLOAD PDF
            </a>
            
            <p class="text-slate-500 mb-12">We've also sent the download link to your email.</p>
            
            <div class="border-t border-slate-200 pt-12">
                <h2 class="anton-text text-2xl uppercase mb-6 tracking-wider">EXPLORE MORE RECIPES</h2>
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="/" class="px-6 py-3 rounded-xl bg-white border border-slate-200 hover:border-brand-500 hover:text-brand-600 transition-all font-semibold">
                        All Recipes
                    </a>
                    <a href="/#packs" class="px-6 py-3 rounded-xl bg-white border border-slate-200 hover:border-brand-500 hover:text-brand-600 transition-all font-semibold">
                        More Recipe Packs
                    </a>
                </div>
            </div>
        </div>

        <!-- Access Denied State -->
        <div id="denied-state" style="display: none;">
            <span class="text-6xl mb-6 block">üîí</span>
            <h1 class="anton-text text-4xl uppercase mb-4 tracking-wider">ACCESS REQUIRED</h1>
            <p id="denied-message" class="text-xl text-slate-600 mb-8">
                Please confirm your email first to access the download.
            </p>
            
            <div class="bg-amber-50 border border-amber-200 rounded-xl p-6 mb-8 text-left">
                <h3 class="font-bold text-amber-800 mb-2">How to get access:</h3>
                <ol class="text-amber-700 space-y-2 list-decimal list-inside">
                    <li>Request the recipe pack from the <a href="/pack-{{PACK_SLUG}}.html" class="underline hover:text-amber-900">download page</a></li>
                    <li>Check your email for a confirmation message</li>
                    <li>Click the confirmation link in the email</li>
                    <li>You'll be redirected here with full access!</li>
                </ol>
            </div>
            
            <a href="/pack-{{PACK_SLUG}}.html" 
                class="inline-flex items-center gap-3 bg-brand-500 text-white px-8 py-4 rounded-2xl font-bold anton-text text-lg hover:bg-brand-600 transition-colors shadow-xl shadow-brand-500/30 tracking-wider">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                REQUEST DOWNLOAD LINK
            </a>
            
            <p class="text-slate-500 mt-6 text-sm">
                Already confirmed? Check your email for the download link, or 
                <a href="mailto:hello@{{SITE_DOMAIN}}" class="text-brand-600 hover:underline">contact support</a>.
            </p>
        </div>
        
    </div>
</main>

<!-- Footer -->
<footer class="bg-slate-900 text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
            <div class="md:col-span-1">
                <a href="/" class="flex items-center mb-4">
                    <img src="/images/logo.png" alt="{{SITE_NAME}}" class="h-12 w-auto">
                </a>
                <p class="text-slate-400 text-sm">{{SITE_TAGLINE}}</p>
            </div>
            
            <div>
                <h4 class="anton-text text-sm tracking-wider mb-4">RECIPES</h4>
                <ul class="space-y-2 text-slate-400 text-sm">
                    <li><a href="/category-all.html" class="hover:text-white transition">All Recipes</a></li>
                    <li><a href="/category-classic.html" class="hover:text-white transition">Classic</a></li>
                    <li><a href="/category-high-protein.html" class="hover:text-white transition">High Protein</a></li>
                </ul>
            </div>
            
            <div>
                <h4 class="anton-text text-sm tracking-wider mb-4">RECIPE PACKS</h4>
                <ul class="space-y-2 text-slate-400 text-sm">
                    <li><a href="/pack-starter.html" class="hover:text-white transition">Starter Pack (Free)</a></li>
                </ul>
            </div>
            
            <div>
                <h4 class="anton-text text-sm tracking-wider mb-4">LEGAL</h4>
                <ul class="space-y-2 text-slate-400 text-sm">
                    <li><a href="/privacy.html" class="hover:text-white transition">Privacy Policy</a></li>
                    <li><a href="/terms.html" class="hover:text-white transition">Terms of Use</a></li>
                </ul>
            </div>
        </div>
        
        <div class="mt-12 pt-8 border-t border-slate-800">
            <p class="text-slate-500 text-xs text-center mb-4">Part of the Protein Recipe Empire</p>
            <div class="flex flex-wrap justify-center gap-4 text-xs text-slate-500">
                <a href="https://proteinmuffins.com" class="hover:text-white transition">Muffins</a>
                <a href="https://proteincookies.co" class="hover:text-white transition">Cookies</a>
                <a href="https://proteinpancakes.co" class="hover:text-white transition">Pancakes</a>
                <a href="https://proteinbrownies.co" class="hover:text-white transition">Brownies</a>
                <a href="https://protein-bread.com" class="hover:text-white transition">Bread</a>
                <a href="https://proteinbars.co" class="hover:text-white transition">Bars</a>
                <a href="https://proteinbites.co" class="hover:text-white transition">Bites</a>
                <a href="https://proteindonuts.co" class="hover:text-white transition">Donuts</a>
                <a href="https://proteinoatmeal.co" class="hover:text-white transition">Oatmeal</a>
                <a href="https://proteincheesecake.co" class="hover:text-white transition">Cheesecake</a>
                <a href="https://proteinpizzas.co" class="hover:text-white transition">Pizza</a>
                <a href="https://proteinpudding.co" class="hover:text-white transition">Pudding</a>
            </div>
        </div>
        
        <div class="mt-8 text-center text-slate-500 text-xs">
            <p>&copy; 2026 <a href="https://HighProtein.Recipes" class="hover:text-amber-400 transition-colors">High Protein Recipes</a>. All recipes macro-verified using USDA FoodData Central.</p>
        </div>
    </div>
</footer>

<!-- Protected Success Page Script -->
<script>
/**
 * Protected Success Page - Inline Version
 * Verifies access token before showing download content
 */
(function() {
  'use strict';

  const VERIFY_ENDPOINT = '/api/verify-access';

  function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      accessToken: params.get('access'),
      email: params.get('email')
    };
  }

  function showState(stateId) {
    ['loading-state', 'success-state', 'denied-state'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = id === stateId ? 'block' : 'none';
    });
  }

  async function verifyAccess(token) {
    try {
      const response = await fetch(`${VERIFY_ENDPOINT}?token=${encodeURIComponent(token)}`);
      return await response.json();
    } catch (error) {
      console.error('[protected-success] Verification error:', error);
      return { success: false, error: 'Network error', code: 'NETWORK_ERROR' };
    }
  }

  async function init() {
    const { accessToken, email } = getUrlParams();

    if (!accessToken) {
      showState('denied-state');
      return;
    }

    showState('loading-state');
    const result = await verifyAccess(accessToken);

    if (result.success) {
      // Update email display
      const emailEl = document.getElementById('user-email');
      if (emailEl) emailEl.textContent = result.data.email;
      
      // Update download button
      const btn = document.getElementById('download-btn');
      if (btn && result.data.pdfUrl) {
        btn.href = result.data.pdfUrl;
      }
      
      showState('success-state');
      
      // Track event
      if (typeof gtag === 'function') {
        gtag('event', 'download_page_accessed', {
          email: result.data.email,
          pack: result.data.packSlug
        });
      }
    } else {
      // Update denied message
      const msg = document.getElementById('denied-message');
      if (msg) {
        switch (result.code) {
          case 'TOKEN_EXPIRED':
            msg.textContent = 'Your access link has expired. Please check your email for the download link, or request a new one.';
            break;
          case 'INVALID_TOKEN':
            msg.textContent = 'This access link is invalid. Please confirm your email first to access the download.';
            break;
          default:
            msg.textContent = 'Unable to verify access. Please confirm your email first to access the download.';
        }
      }
      showState('denied-state');
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

</body>
</html>
